{% extends "layout.html" %}

{% block title %}Admin - Prenotazioni BJJ{% endblock %}

{% block content %}
<h1>Admin - Gestione Prenotazioni e Lezioni</h1>

<p><a href="{{ url_for('user_bp.user_logout') }}">Logout</a></p>

<!-- Form aggiungi nuova lezione -->
<h2>Aggiungi nuova lezione</h2>
<form action="{{ url_for('admin_bp.add_classe') }}" method="post" class="admin-form">
    <input type="date" name="data" required>
    <input type="time" name="ora" required>
    <input type="number" name="max_posti" min="1" required>
    <button type="submit">Aggiungi</button>
</form>

<hr>

<!-- Tabella classi -->
<table class="admin-table">
    <tr>
        <th>Data</th>
        <th>Ora</th>
        <th>Posti massimi</th>
        <th>Prenotati</th>
        <th>Posti disponibili</th>
        <th>Stato</th>
        <th>Azioni</th>
    </tr>
    {% for entry in dati %}
    <tr class="{{ entry.stato }}">
        <td>{{ entry.classe.data }}</td>
        <td>{{ entry.classe.ora }}</td>
        <td>{{ entry.classe.max_posti }}</td>
        <td>{{ entry.count }}</td>
        <td>{{ entry.classe.max_posti - entry.count }}</td>
        <td>
            {% if entry.stato == "piena" %}
                <strong>Piena</strong>
            {% elif entry.stato == "sotto_minimo" %}
                <strong>Sotto minimo ({{ min_iscritti }})</strong>
            {% else %}
                <strong>OK</strong>
            {% endif %}
        </td>
        <td class="action-links">
            <a href="{{ url_for('admin_bp.edit_classe', classe_id=entry.classe.id) }}">Modifica</a>
            <a href="{{ url_for('admin_bp.delete_classe', classe_id=entry.classe.id) }}" onclick="return confirm('Confermi eliminazione?')">Elimina</a>
        </td>
    </tr>
    <tr>
        <td colspan="7">
            <strong>Prenotati:</strong>
            {% if entry.prenotati %}
                {{ entry.prenotati|join(", ") }}
            {% else %}
                Nessuna prenotazione
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% endblock %}
